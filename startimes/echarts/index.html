<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>四达时代网络监控-OTT</title>
  <link rel="stylesheet" href="./css/main.css">
  <script src="./js/jquery.min.js" charset="utf-8"></script>
  <script src="./js/echarts.js" charset="utf-8"></script>
  <script src="./js/zabbix.js" charset="utf-8"></script>
</head>

<body>
  <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
  <div id="main"></div>
  <div class="total">
    <div class="item">
      <div class="label"><img src='./img/user.png' /></div>
      <div class="content">
        <div class="title">总在线用户数</div>
        <div id="user" class="number">0</div>
      </div>
    </div>
    <div class="item">
      <div class="label"><img src='./img/network.png' /></div>
      <div class="content">
        <div class="title">总带宽(Gbit/s)</div>
        <div id="network" class="number">0</div>
      </div>
    </div>
    <div class="item">
      <div class="label"><img src='./img/partner.png' /></div>
      <div class="content">
        <div class="title">合作运营商数</div>
        <div id="partner" class="number">0</div>
      </div>
    </div>
  </div>
  <script src="./map/africa.js" charset="utf-8"></script>
  <script src="./js/config.js" charset="utf-8"></script>
  <script type="text/javascript">
    echarts.registerMap('customMap', mapJson)
    var myChart = echarts.init(document.getElementById('main'))
    var option = {
      backgroundColor: '#333333',
      geo: {
        name: '非洲地图',
        map: 'customMap',
        roam: true,
        zoom: 1.1,
        itemStyle: {
          areaColor: '#151515',
          borderColor: '#2b2b2b'
        },
        emphasis: {
          itemStyle: {
            areaColor: '#151515',
            borderColor: '#2b2b2b'
          }
        }
      },
      series: [
        {
          name: '地点',
          type: 'scatter',
          coordinateSystem: 'geo',
          zlevel: 10,
          showEffectOn: 'render',
          data: [
            {name: '亚马逊云', value:[-8.3, 37.5 , 68, 12, 200], symbol: awsPath, symbolSize: 30, label: {
              show: true,
              position: [-210, -15],
              backgroundColor: 'rgba(0,0,0,0.3)',
              borderWidth: 1,
              borderColor: 'rgba(255,255,255,0.3)',
              padding: [8, 30, 8, 20],
              borderRadius: 5,
              formatter: function (params) {
                var successType = params.value[2] <= 10 ? 'good' : params.value[2] <= 50 ? 'well' : 'bad'
                var responseType = params.value[3] <= 10 ? 'good' : params.value[3] <= 50 ? 'well' : 'bad'
                var qpsType = params.value[4] <= 10 ? 'good' : params.value[4] <= 50 ? 'well' : 'bad'
                var res = '{title|全局调度系统的指标}\n' +
                          '{subTitle|成功率：}{' + successType + '|' + params.value[2] + '}\n' +
                          '{subTitle|响应时间：}{' + responseType + '|' + params.value[3] + '}\n' +
                          '{subTitle|QPS：}{' + qpsType + '|' + params.value[4] + '}'
                return res
              },
              rich: richStyle
            }},
            {name: '北京', value:[58, 35.5], symbol: chinaPath, symbolSize: [50,33.31]},
            {name: '卫星', value:[-30, 25], symbol: satellitePath, symbolSize: 50},
            {name: '上云站', value:[14, -33.5, '132/150', '94/150', '53/150', '150/150', '132/150'], symbol: radarPath, symbolSize: 40, label: {
              show: true,
              position: [-350, -100],
              backgroundColor: 'rgba(0,0,0,0.3)',
              borderWidth: 1,
              borderColor: 'rgba(255,255,255,0.3)',
              padding: [8, 60, 8, 20],
              borderRadius: 5,
              formatter: function (params) {
                var jieshou = parseInt(params.value[2].split('/')[0]),
                zhuanma = parseInt(params.value[3].split('/')[0]),
                qiepian = parseInt(params.value[4].split('/')[0]),
                weixing = parseInt(params.value[5].split('/')[0]),
                aws = parseInt(params.value[6].split('/')[0])
                var jieshouType = jieshou >= 150 ? 'good' : jieshou >= 100 ? 'well' : 'bad',
                zhuanmaType = zhuanma >= 150 ? 'good' : zhuanma >= 100 ? 'well' : 'bad',
                qiepianType = qiepian >= 150 ? 'good' : qiepian >= 100 ? 'well' : 'bad',
                weixingType = weixing >= 150 ? 'good' : weixing >= 100 ? 'well' : 'bad',
                awsType = aws >= 150 ? 'good' : aws >= 100 ? 'well' : 'bad'
                res = '{title|全局调度系统的指标}\n' +
                          '{subTitle|接收：}{' + jieshouType + '|' + params.value[2] + '}\n' +
                          '{subTitle|转码：}{' + zhuanmaType + '|' + params.value[3] + '}\n' +
                          '{subTitle|切片：}{' + qiepianType + '|' + params.value[4] + '}\n' +
                          '{subTitle|卫星上传：}{' + weixingType + '|' + params.value[5] + '}\n' +
                          '{subTitle|AWS上传：}{' + awsType + '|' + params.value[6] + '}'
                return res
              },
              rich: richStyle
            }}
          ]
        },
        {
          name: '网络状态',
          type: 'lines',
          zlevel: 2,
          effect: {
            show: true,
            constantSpeed: 30,
            symbol: 'arrow',
            symbolSize: 6,
            trailLength: 0,
          },
          data: convertLinesData(pack_loss_probability)
        },
        {
          name: 'cache节点告警',
          type: 'effectScatter',
          coordinateSystem: 'geo',
          symbolSize: 7,
          showEffectOn: 'render',
          rippleEffect: {
            period: 4,
            scale: 4,
            brushType: 'fill'
          },
          data: convertPonitData(cache_error)
        }
      ]
    }
    myChart.setOption(option, true)
  </script>
  <script src="./js/main.js" charset="utf-8"></script>
</body>

</html>
